var He=Object.defineProperty;var we=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var Ie=(s,l,a)=>l in s?He(s,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[l]=a,S=(s,l)=>{for(var a in l||(l={}))Ue.call(l,a)&&Ie(s,a,l[a]);if(we)for(var a of we(l))Ye.call(l,a)&&Ie(s,a,l[a]);return s};var x=(s,l,a)=>new Promise((c,v)=>{var y=u=>{try{F(a.next(u))}catch(d){v(d)}},f=u=>{try{F(a.throw(u))}catch(d){v(d)}},F=u=>u.done?c(u.value):Promise.resolve(u.value).then(y,f);F((a=a.apply(s,l)).next())});import{u as t,g as qe,c as X,w as ae,ap as Ge,y as pe,J as Te,h as Xe,d as ke,K as ze,r as Be,f as se,o as Je,Z as me,a8 as De,a9 as le,k as Ee,ae as ue,_ as Qe,aa as Ae,ad as Oe,ac as ye,F as Ze,aj as _e,ak as xe,ao as Me}from"./vue-DhXvXWyK.js";import{_ as et}from"./FormItem.vue_vue_type_script_lang-BQsfJt-d.js";import{b as tt,c as nt,_ as st}from"./BasicForm.vue_vue_type_style_index_0_lang-BL3smh9L.js";import{u as at,i as fe,d as Le,a as it}from"./helper-JLwI6lBn.js";import{C as Y,aq as k,aR as q,aS as ot,aN as ve,aQ as Pe,c as rt,G as ct}from"./entry/index-BcidWyMC.js";import{e as J,l as de,s as M,ah as Z,aF as je,d as z,v as Se,f as ee,ax as lt,W as $e,aG as ut,a3 as ft,ab as dt,a8 as pt}from"./antd-BFwNME3X.js";import{a as ht}from"./index-DVzcH--h.js";function mt(s,l,a){const c=/^\[(.+)\]$/;if(c.test(s)){const v=s.match(c);if(v&&v[1]){const y=v[1].split(",");return l=Array.isArray(l)?l:[l],y.forEach((f,F)=>{M(a,f.trim(),l[F])}),!0}}}function At(s,l,a){const c=/^\{(.+)\}$/;if(c.test(s)){const v=s.match(c);if(v&&v[1]){const y=v[1].split(",");return l=Y(l)?l:{},y.forEach(f=>{M(a,f.trim(),l[f.trim()])}),!0}}}function yt({defaultValueRef:s,getSchema:l,formModel:a,getProps:c}){function v(u){var g,B;if(!Y(u))return{};const d={};for(const D of Object.entries(u)){let[,r]=D;const[T]=D;if(!T||k(r)&&r.length===0||J(r))continue;const i=t(c).transformDateFunc;Y(r)&&(r=i==null?void 0:i(r)),k(r)&&((g=r[0])!=null&&g.format)&&((B=r[1])!=null&&B.format)&&(r=r.map(b=>i==null?void 0:i(b))),de(r)&&(r=r.trim()),!mt(T,r,d)&&!At(T,r,d)&&M(d,T,r)}return y(d)}function y(u){const d=t(c).fieldMapToTime;if(!d||!Array.isArray(d))return u;for(const[g,[B,D],r="YYYY-MM-DD"]of d){if(!g||!B||!D)continue;if(!Z(u,g)){je(u,g);continue}const[T,i]=Z(u,g),[b,$]=Array.isArray(r)?r:[r,r];!z(T)&&!Se(T)&&M(u,B,f(T,b)),!z(i)&&!Se(i)&&M(u,D,f(i,$)),je(u,g)}return u}function f(u,d){return d==="timestamp"?q(u).unix():d==="timestampStartDay"?q(u).startOf("day").unix():q(u).format(d)}function F(){const u=t(l),d={};u.forEach(g=>{const{defaultValue:B,defaultValueObj:D,componentProps:r={}}=g,T=Object.keys(D||{});T.length&&T.forEach(i=>{d[i]=D[i],a[i]===void 0&&(a[i]=D[i])}),z(B)||(d[g.field]=B,a[g.field]===void 0&&(a[g.field]=B)),z(r==null?void 0:r.defaultValue)||(d[g.field]=r==null?void 0:r.defaultValue,a[g.field]===void 0&&(a[g.field]=r==null?void 0:r.defaultValue))}),s.value=ee(d)}return{handleFormValues:v,initDefault:F}}const G=24;function vt({advanceState:s,emit:l,getProps:a,getSchema:c,formModel:v,defaultValueRef:y}){const f=qe(),{realWidthRef:F,screenEnum:u,screenRef:d}=ot(),g=X(()=>{if(!s.isAdvanced)return 0;const i=t(a).emptySpan||0;if(lt(i))return i;if(Y(i)){const{span:b=0}=i,$=t(d);return i[$.toLowerCase()]||b||0}return 0});ae([()=>t(c),()=>s.isAdvanced,()=>t(F)],()=>{const{showAdvancedButton:i}=t(a);i&&pe(()=>{r()})},{immediate:!0});function B(i,b=0,$=!1){const L=t(F),_=parseInt(i.md)||parseInt(i.xs)||parseInt(i.sm)||i.span||G,j=parseInt(i.lg)||_,R=parseInt(i.xl)||j,N=parseInt(i.xxl)||R;return L<=u.LG?b+=_:L<u.XL?b+=j:L<u.XXL?b+=R:b+=N,$?(s.hideAdvanceBtn=!1,b<=G*2?(s.hideAdvanceBtn=!0,s.isAdvanced=!0):b>G*2&&b<=G*(t(a).autoAdvancedLine||3)?s.hideAdvanceBtn=!1:s.isLoad||(s.isLoad=!0,s.isAdvanced=!s.isAdvanced),{isAdvanced:s.isAdvanced,itemColSum:b}):b>G*(t(a).alwaysShowLines||1)?{isAdvanced:s.isAdvanced,itemColSum:b}:{isAdvanced:!0,itemColSum:b}}const D=Ge({});function r(){var L;let i=0,b=0;const{baseColProps:$={}}=t(a);for(const _ of t(c)){const{show:j,ifShow:R,colProps:N}=_,W={schema:_,model:v,field:_.field,values:S(S({},t(y)),v)};let O=!0;if(O&&$e(R)&&(O=R),O&&J(R)&&(O=R(W)),O&&$e(j)&&(O=j),O&&J(j)&&(O=j(W)),O&&(N||$)){const{itemColSum:U,isAdvanced:Q}=B(S(S({},$),N),i);i=U||0,Q&&(b=i),D[_.field]=Q}}(L=f==null?void 0:f.proxy)==null||L.$forceUpdate(),s.actionSpan=b%G+t(g),B(t(a).actionColOptions||{span:G},i,!0),l("advanced-change",s.isAdvanced)}function T(){s.isAdvanced=!s.isAdvanced}return{handleToggleAdvanced:T,fieldsIsAdvancedMap:D}}function Ce(s){return at.includes(s)}function gt(s,l={}){const a=/^\[(.+)\]$/;if(a.test(s)){const c=s.match(a);if(c&&c[1]){const v=c[1].split(",");if(!v.length)return;const y=[];return v.forEach((f,F)=>{M(y,F,l[f.trim()])}),y.filter(Boolean).length?y:void 0}}}function Ft({emit:s,getProps:l,formModel:a,getSchema:c,defaultValueRef:v,formElRef:y,schemaRef:f,handleFormValues:F}){function u(){return x(this,null,function*(){const{resetFunc:e,submitOnReset:o}=t(l);e&&J(e)&&(yield e()),t(y)&&(Object.keys(a).forEach(n=>{const A=t(c).find(w=>w.field===n),V=A==null?void 0:A.defaultValueObj,P=Object.keys(V||{});P.length&&P.forEach(w=>{a[w]=V[w]}),a[n]=bt(A,v,n)}),pe(()=>W()),s("reset",Te(a)),o&&U())})}const d=()=>t(c).map(e=>[...e.fields||[],e.field]).flat(1).filter(Boolean);function g(e){return x(this,null,function*(){if(Object.keys(e).length===0)return;const o=d(),p=[];o.forEach(n=>{const A=t(c).find(I=>I.field===n),V=Z(e,n),P=ut(e,n),{componentProps:w}=A||{};let C=w;typeof w=="function"&&(C=C({formModel:t(a),formActionType:Q}));let H;const ie=I=>I?C!=null&&C.valueFormat?I:q(I):null;if(_(A==null?void 0:A.component)&&(H=gt(n,e),H)){const I=H||V;if(Array.isArray(I)){const oe=[];for(const te of I)oe.push(ie(te));t(a)[n]=oe,p.push(n)}else t(a)[n]=ie(I),p.push(n)}if(Ce(A==null?void 0:A.component)){H=Z(V,n);const I=H||V;I&&(k(I)?t(a)[n]=I:typeof I=="string"&&(t(a)[n]=[I])),p.push(n);return}if(P){H=Z(V,n);const I=H||V;t(a)[n]=I,C!=null&&C.onChange&&(C==null||C.onChange(I)),p.push(n)}}),j(p).catch(n=>{})})}function B(e){if(!Array.isArray(e)||Array.isArray(e)&&e.length===0)return;const o=[],p=Object.keys(t(a));p&&(e.forEach(n=>{p.includes(n)&&(o.push(n),t(a)[n]=ee(t(Z(v.value,n))))}),j(o).catch(n=>{}))}function D(e){return x(this,null,function*(){const o=ee(t(c));if(!e)return;let p=de(e)?[e]:e;de(e)&&(p=[e]);for(const n of p)r(n,o);f.value=o})}function r(e,o){if(de(e)){const p=o.findIndex(n=>n.field===e);p!==-1&&(delete a[e],o.splice(p,1))}}function T(e,o,p=!1){return x(this,null,function*(){const n=ee(t(c)),A=Array.isArray(e)?e.map(w=>w.field):[e.field];if(n.find(w=>A.includes(w.field))){ve("There are schemas that have already been added");return}const V=n.findIndex(w=>w.field===o),P=Y(e)?[e]:e;!o||V===-1||p?p?n.unshift(...P):n.push(...P):V!==-1&&n.splice(V+1,0,...P),f.value=n,$(e)})}function i(e){return x(this,null,function*(){let o=[];if(Y(e)&&o.push(e),k(e)&&(o=[...e]),!o.every(n=>fe(n.component)||Reflect.has(n,"field")&&n.field)){ve("All children of the form Schema array that need to be updated must contain the `field` field");return}f.value=o})}function b(e){return x(this,null,function*(){let o=[];if(Y(e)&&o.push(e),k(e)&&(o=[...e]),!o.every(V=>fe(V.component)||Reflect.has(V,"field")&&V.field)){ve("All children of the form Schema array that need to be updated must contain the `field` field");return}const n=[],A=[];t(c).forEach(V=>{const P=o.find(w=>V.field===w.field);if(P){const w=Pe(V,P);A.push(w),n.push(w)}else n.push(V)}),$(A),f.value=ft(n,"field")})}function $(e){let o=[];Y(e)&&o.push(e),k(e)&&(o=[...e]);const p={},n=L();o.forEach(A=>{!fe(A.component)&&Reflect.has(A,"field")&&A.field&&!z(A.defaultValue)&&(!(A.field in n)||z(n[A.field]))&&(p[A.field]=A.defaultValue)}),g(p)}function L(){return t(y)?F(Te(t(a))):{}}function _(e){return Le.includes(e)}function j(e){return x(this,null,function*(){var p;const o=yield(p=t(y))==null?void 0:p.validateFields(e);return F(o)})}function R(e){return x(this,null,function*(){var o;yield(o=t(y))==null?void 0:o.setProps(e)})}function N(e){return x(this,null,function*(){var n;let o;e===void 0?o=d():o=e===Array.isArray(e)?e:void 0;const p=yield(n=t(y))==null?void 0:n.validate(o);return F(p)})}function W(e){return x(this,null,function*(){var o;yield(o=t(y))==null?void 0:o.clearValidate(e)})}function O(e,o){return x(this,null,function*(){var p;yield(p=t(y))==null?void 0:p.scrollToField(e,o)})}function U(e){return x(this,null,function*(){e&&e.preventDefault();const{submitFunc:o}=t(l);if(o&&J(o)){yield o();return}if(t(y))try{const n=yield N();s("submit",n)}catch(n){if((n==null?void 0:n.outOfDate)===!1&&(n!=null&&n.errorFields))return;throw new Error(n)}})}const Q={getFieldsValue:L,setFieldsValue:g,resetFields:u,updateSchema:b,resetSchema:i,setProps:R,removeSchemaByField:D,appendSchemaByField:T,clearValidate:W,validateFields:j,validate:N,submit:U,scrollToField:O};return{handleSubmit:U,clearValidate:W,validate:N,validateFields:j,getFieldsValue:L,updateSchema:b,resetSchema:i,appendSchemaByField:T,removeSchemaByField:D,resetFields:u,setFieldsValue:g,scrollToField:O,resetDefaultField:B}}function bt(s,l,a){let c=ee(l.value[a]);return wt(s)?z(c)?void 0:c:(!c&&s&&Vt(s)&&(c=[0,0]),!c&&s&&s.component==="ApiTree"&&(c=[]),c)}function Vt(s){if(s.component==="Slider"&&s.componentProps&&"range"in s.componentProps)return!0}function wt(s){return(s==null?void 0:s.component)&&it.includes(s.component)}function It(v){return x(this,arguments,function*({getSchema:s,getProps:l,formElRef:a,isInitedDefault:c}){Xe(()=>x(this,null,function*(){if(t(c)||!t(l).autoFocusFirstItem)return;yield pe();const y=t(s),f=t(a),F=f==null?void 0:f.$el;if(!f||!F||!y||y.length===0)return;const u=y[0];if(!u.component||!u.component.includes("Input"))return;const d=F.querySelector(".ant-row:first-child input");d&&(d==null||d.focus())}))})}const St=ke({name:"BasicForm",__name:"BasicForm",props:tt,emits:["advanced-change","reset","submit","register","field-value-change"],setup(s,{expose:l,emit:a}){const c=s,v=a,y=ze(),f=Be({}),F=ht(),u=Be({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),d=se({}),g=se(!1),B=se(),D=se(null),r=se(null),{prefixCls:T}=rt("basic-form"),i=X(()=>S(S({},c),t(B))),b=X(()=>[T,{[`${T}--compact`]:t(i).compact}]),$=X(()=>{const{baseRowStyle:h={},rowProps:K}=t(i);return S({style:h},K)}),L=X(()=>S(S(S({},y),c),t(i))),_=X(()=>{var K;const h=ee(t(D)||t(i).schemas);for(const m of h){const{defaultValue:E,component:ne,componentProps:re={},isHandleDateDefaultValue:Re=!0,field:ge,isHandleDefaultValue:Ne=!0,valueFormat:Fe,ifShow:he}=m;if(t(i).showAdvancedButton&&(m.ifshow2=J(he)?he({schema:m,values:f,model:f,field:ge}):he),Re&&E&&ne&&Le.includes(ne)){const We={schema:m,tableAction:(K=c.tableAction)!=null?K:{},formModel:f,formActionType:{}},ce=re?typeof re=="function"?re(We).valueFormat:re.valueFormat:null;if(!Array.isArray(E))m.defaultValue=ce?q(E).format(ce):q(E);else{const be=[];E.forEach(Ve=>{be.push(ce?q(Ve).format(ce):q(Ve))}),m.defaultValue=be}}E&&Ce(m==null?void 0:m.component)&&(k(E)?m.defaultValue=E:typeof E=="string"&&(m.defaultValue=[E])),Ne&&E&&ne&&J(Fe)&&(m.defaultValue=Fe({value:E,schema:m,model:f,field:ge}))}return t(i).showAdvancedButton?h.filter(m=>!fe(m.component)):h}),{handleToggleAdvanced:j,fieldsIsAdvancedMap:R}=vt({advanceState:u,emit:v,getProps:i,getSchema:_,formModel:f,defaultValueRef:d}),{handleFormValues:N,initDefault:W}=yt({getProps:i,defaultValueRef:d,getSchema:_,formModel:f});It({getSchema:_,getProps:i,isInitedDefault:g,formElRef:r});const{handleSubmit:O,setFieldsValue:U,clearValidate:Q,validate:e,validateFields:o,getFieldsValue:p,updateSchema:n,resetSchema:A,appendSchemaByField:V,removeSchemaByField:P,resetFields:w,scrollToField:C,resetDefaultField:H}=Ft({emit:v,getProps:i,formModel:f,getSchema:_,defaultValueRef:d,formElRef:r,schemaRef:D,handleFormValues:N});nt({resetAction:w,submitAction:O}),ae(()=>t(i).model,()=>{const{model:h}=t(i);h&&U(h)},{immediate:!0}),ae(()=>c.schemas,h=>{A(h!=null?h:[])}),ae(()=>_.value,h=>{pe(()=>{var K;(K=F==null?void 0:F.redoModalHeight)==null||K.call(F)}),!t(g)&&h!=null&&h.length&&(W(),g.value=!0)}),ae(()=>f,ct(()=>{t(i).submitOnChange&&O()},300),{deep:!0});function ie(h){return x(this,null,function*(){B.value=Pe(t(B)||{},h)})}function I(h,K,m){f[h]=K,v("field-value-change",h,K),m&&m.itemProps&&!m.itemProps.autoLink&&o([h]).catch(E=>{})}function oe(h){const{autoSubmitOnEnter:K}=t(i);if(K&&h.key==="Enter"&&h.target&&h.target instanceof HTMLElement){const m=h.target;m&&m.tagName&&m.tagName.toUpperCase()==="INPUT"&&O()}}const te={getFieldsValue:p,setFieldsValue:U,resetFields:w,updateSchema:n,resetSchema:A,setProps:ie,removeSchemaByField:P,appendSchemaByField:V,clearValidate:Q,validateFields:o,validate:e,submit:O,scrollToField:C,resetDefaultField:H},Ke=X(()=>S(S({},i.value),u));return l(S({},te)),Je(()=>{W(),v("register",te)}),(h,K)=>(me(),De(t(pt),ye(L.value,{class:b.value,ref_key:"formElRef",ref:r,model:f,onKeypress:Me(oe,["enter"])}),{default:le(()=>[Ee(t(dt),_e(xe($.value)),{default:le(()=>[ue(h.$slots,"formHeader"),(me(!0),Qe(Ze,null,Ae(_.value,m=>(me(),De(et,{key:m.field,isAdvanced:t(R)[m.field],tableAction:h.tableAction,formActionType:te,schema:m,formProps:i.value,allDefaultValues:d.value,formModel:f,setFormModel:I},Oe({_:2},[Ae(Object.keys(h.$slots),E=>({name:E,fn:le(ne=>[ue(h.$slots,E,ye({ref_for:!0},ne||{}))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Ee(st,ye(Ke.value,{onToggleAdvanced:t(j)}),Oe({_:2},[Ae(["resetBefore","submitBefore","advanceBefore","advanceAfter"],m=>({name:m,fn:le(E=>[ue(h.$slots,m,_e(xe(E||{})))])}))]),1040,["onToggleAdvanced"]),ue(h.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model"]))}});export{St as _};
