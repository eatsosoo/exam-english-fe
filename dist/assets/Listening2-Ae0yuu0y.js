var ae=Object.defineProperty;var M=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var V=(r,i,n)=>i in r?ae(r,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[i]=n,U=(r,i)=>{for(var n in i||(i={}))oe.call(i,n)&&V(r,n,i[n]);if(M)for(var n of M(i))se.call(i,n)&&V(r,n,i[n]);return r};var L=(r,i,n)=>new Promise((x,q)=>{var f=m=>{try{t(n.next(m))}catch(b){q(b)}},v=m=>{try{t(n.throw(m))}catch(b){q(b)}},t=m=>m.done?x(m.value):Promise.resolve(m.value).then(f,v);t((n=n.apply(r,i)).next())});import{T as ne}from"./index-C3lnRWnE.js";import{aZ as le,c as ue,a2 as ie,a as re,b as ce,d as de}from"./entry/index-BcidWyMC.js";import{L as T}from"./data-C-2nBY8q.js";import{_ as me}from"./Question.vue_vue_type_script_setup_true_lang-CiV2iraA.js";import{u as pe,d as fe}from"./exam-CAJo7aCX.js";import{R as E,ab as ve,aa as N,aC as _e}from"./antd-BFwNME3X.js";import{d as he,f as y,c as ye,w as ge,a7 as be,Z as _,_ as g,k as h,ad as ke,a9 as p,G as $,a0 as C,u as d,F as I,aa as j,a8 as F,$ as w,ab as z,a1 as qe}from"./vue-DhXvXWyK.js";import"./uuid-D0SLUWHI.js";import"./onMountedOrActivated-CvY6VkYA.js";const Ce={class:"bg-white px-2 mb-8"},we={class:"flex items-center gap-2 mb-4"},xe=["src"],Se={class:"p-4 re-box-shadow rounded-lg"},Ae={class:"flex gap-2 ml-4 mb-2"},Ue=["onClick"],Le={class:"re-box-shadow rounded-lg pa-4 w-full"},Te={key:1},$e=he({__name:"Listening2",props:{value:{type:Array,default:T},isHomework:{type:Boolean,default:!1}},setup(r,{expose:i}){const n=r,x=E.TabPane,q={Authorization:`Bearer ${le()}`},f=y(0),v=y(n.value[0].questions[0]),t=y(n.value),m=y(!1),b=y(!1),D=y([]),K=y(""),P=ye(()=>Array.from({length:t.value.length},(s,e)=>({key:e,tab:`Section ${e+1}`}))),{t:c}=re(),{createMessage:k,createErrorModal:R,createSuccessModal:G}=ce(),{prefixCls:B}=ue("register"),{uploadUrl:Q}=ie();function H(s,e){const a=t.value[s].questions.findIndex(u=>{var o;return u.question_no===((o=v.value)==null?void 0:o.question_no)});a!==-1&&(t.value[s].questions[a]=e),k.success(c("common.updateSuccess"))}function Z(s){const e=t.value[s].questions,a=e.at(-1),u=a?a.question_no+1:1;e.push({question_no:u,content:"",type:"choice",options:["A","B"].map(o=>({id:o,text:o})),answer:null})}function O(s){t.value[f.value]=s}function W(){t.value.push(U({},T[0]))}function J(){v.value=t.value[f.value].questions[0]}function X(s){var l;const e=s.file,a=e==null?void 0:e.status,u=(l=e==null?void 0:e.response)==null?void 0:l.result.items,o=e==null?void 0:e.name;a==="done"?(k.success(c("common.uploadFileSuccess",{name:o})),K.value=u):a==="error"&&k.error(c("common.uploadFileFail",{name:o}))}function Y(s){const e=s.type.startsWith("audio/");e||k.error(c("sys.validate.uploadOnlyAudio"));const a=s.size/1024/1024<2;return a||k.error(c("sys.validate.minFileSize",{size:"2MB"})),e&&a}const ee=u=>L(this,[u],function*({file:s,onSuccess:e,onError:a}){const o=new FormData;o.append("media",s);try{const l=yield pe(o);l&&(t.value[f.value].media=l.items),e(l)}catch(l){a(l)}});function te(s){return L(this,null,function*(){var e;try{m.value=!0;const{subject:a,questions:u,id:o,media:l}=t.value[f.value],S={id:o||null,exam_id:s,type:"Listening",subject:a,questions:u,duration:40,media:l,questions_count:u.length},A=yield fe(S);A&&(G({title:c("form.exam.editSkill",{skill:"Reading"}),content:c("common.createSuccessfully"),getContainer:()=>document.body.querySelector(`.${B}`)||document.body}),O(A.items))}catch(a){const u=(e=a.response)==null?void 0:e.data.message;R({title:c("sys.api.errorTip"),content:u||a.message||c("sys.api.networkExceptionMsg"),getContainer:()=>document.body.querySelector(`.${B}`)||document.body})}finally{m.value=!1}})}return ge(()=>n.value,s=>{t.value=s.length===0?T:s,v.value=t.value[0].questions[0],f.value=0}),i({submitAll:te}),(s,e)=>{const a=be("a-button");return _(),g("div",Ce,[h(d(E),{activeKey:f.value,"onUpdate:activeKey":e[0]||(e[0]=u=>f.value=u),onChange:J},ke({default:p(()=>[(_(!0),g(I,null,j(P.value,(u,o)=>(_(),F(d(x),{key:u.key,tab:u.tab},{default:p(()=>[h(d(ve),{gutter:[16,16]},{default:p(()=>[h(d(N),{span:12},{default:p(()=>[w("div",we,[h(d(_e),{name:"media",beforeUpload:Y,fileList:D.value,action:d(Q),headers:q,showUploadList:!1,customRequest:ee,onChange:X},{default:p(()=>[h(a,{preIcon:"ant-design:upload-outlined",loading:b.value},{default:p(()=>[$(C(d(c)("common.uploadAudio")),1)]),_:1},8,["loading"])]),_:1},8,["fileList","action"]),t.value[o].media?(_(),g("audio",{key:0,src:t.value[o].media,controls:"",class:"h-8"},null,8,xe)):z("",!0)]),w("div",Se,[h(d(ne),{modelValue:t.value[o].subject,"onUpdate:modelValue":l=>t.value[o].subject=l,height:550},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024),h(d(N),{span:12},{default:p(()=>[w("div",Ae,[(_(!0),g(I,null,j(t.value[o].questions,(l,S)=>(_(),g("div",{key:`${u.key}_${S}`,class:qe(["border rounded-full h-10 w-10 flex items-center justify-center cursor-pointer",v.value.question_no===l.question_no?"border-blue text-blue":"border-gray text-gray"]),onClick:A=>v.value=U({},l)},C(l.question_no),11,Ue))),128)),t.value[o].questions.length<=10?(_(),F(a,{key:0,class:"border rounded-full h-10 w-10 flex items-center justify-center cursor-pointer",onClick:l=>Z(o)},{default:p(()=>[$("+")]),_:2},1032,["onClick"])):z("",!0)]),w("div",Le,[v.value?(_(),F(me,{key:0,value:v.value,"onUpdate:value":l=>H(o,l)},null,8,["value","onUpdate:value"])):(_(),g("h3",Te,C(`${d(c)("common.pleaseSelectQuestion")} ${u.tab}`),1))])]),_:2},1024)]),_:2},1024)]),_:2},1032,["tab"]))),128))]),_:2},[t.value.length<3&&!r.isHomework?{name:"rightExtra",fn:p(()=>[h(a,{type:"default",onClick:W},{default:p(()=>[$(C(d(c)("common.add"))+" Section",1)]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}}),Ke=de($e,[["__scopeId","data-v-826a0a8c"]]);export{Ke as default};
