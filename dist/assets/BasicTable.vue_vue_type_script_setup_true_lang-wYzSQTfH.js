var Jt=Object.defineProperty,Vt=Object.defineProperties;var Xt=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var Zt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable;var nt=(n,a,t)=>a in n?Jt(n,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[a]=t,k=(n,a)=>{for(var t in a||(a={}))Zt.call(a,t)&&nt(n,t,a[t]);if(tt)for(var t of tt(a))Qt.call(a,t)&&nt(n,t,a[t]);return n},ie=(n,a)=>Vt(n,Xt(a));var le=(n,a,t)=>new Promise((s,l)=>{var c=r=>{try{u(t.next(r))}catch(o){l(o)}},f=r=>{try{u(t.throw(r))}catch(o){l(o)}},u=r=>r.done?s(r.value):Promise.resolve(r.value).then(c,f);u((t=t.apply(n,a)).next())});import{d as ce,Z as P,_ as fe,ae as we,G as re,a0 as W,k as K,u as e,c as T,f as N,w as de,l as Be,J as Se,r as gt,h as mt,o as Ve,y as Fe,al as en,K as pt,a7 as vt,a8 as G,a9 as x,$ as ue,a1 as be,ab as V,F as tn,aa as Ye,m as Ct,A as yt,ah as nn,e as an,ad as at,aj as ze,ak as Le,ac as ot}from"./vue-DhXvXWyK.js";import{_ as on}from"./BasicForm.vue_vue_type_script_setup_true_lang-DbX2m63q.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BL3smh9L.js";import{ap as lt,c as Ae,a as xe,aq as Ue,ar as ln,as as sn,v as cn,C as rn,at as un,U as fn,_ as st,au as St,e as dn,av as hn,d as gn,aw as qe,ax as mn,ay as pn,az as vn}from"./entry/index-BcidWyMC.js";import"./componentMap-BjYe58Mw.js";import{u as Cn}from"./useForm-CX4sdfhA.js";import{ac as yn,W as Ce,ad as Sn,ae as wn,f as ye,e as X,l as Xe,a as bn,af as _n,ag as xn,ah as ct,o as Ze,X as Rn,a9 as Oe,ai as Tn,T as Ke,a7 as wt,aj as In,d as it,D as kn,x as Me,ak as Kn,a6 as Fn,a1 as Pn,a2 as An,al as Dn,am as bt,an as En}from"./antd-BFwNME3X.js";import{_ as $n,p as se,a as Je,u as _t,b as On,c as Bn}from"./TableImg.vue_vue_type_style_index_0_lang-D3F4T3v_.js";import{P as Qe,a as Hn,D as Nn,I as Pe,A as je,R as ve,F as zn,u as De,c as Ln}from"./index-BKjGR123.js";import{b as rt}from"./uuid-D0SLUWHI.js";import Mn from"./sortable.esm-CoO8jRpa.js";const Un={class:"edit-header-cell"},ut=ce({name:"EditTableHeaderIcon",__name:"EditTableHeaderIcon",props:{title:{type:String,default:""}},setup(n){return(a,t)=>(P(),fe("span",Un,[we(a.$slots,"default"),re(" "+W(n.title)+" ",1),K(e(yn))]))}}),jn=ce({name:"TableHeaderCell",components:{EditTableHeaderCell:ut,BasicHelp:lt},props:{column:{type:Object,default:()=>({})}},setup(n){const{prefixCls:a}=Ae("basic-table-header-cell"),t=T(()=>{var c;return!!((c=n.column)!=null&&c.edit)}),s=T(()=>{var f;const c=n.column;return typeof c.customHeaderRender=="function"?c.customHeaderRender(c):(c==null?void 0:c.customTitle)||((f=n.column)==null?void 0:f.title)}),l=T(()=>{var c;return(c=n.column)==null?void 0:c.helpMessage});return()=>K("div",null,[t.value?K(ut,null,{default:()=>[s.value]}):K("span",{class:"default-header-cell"},[s.value]),l.value&&K(lt,{text:l.value,class:`${a}__help`},null)])}});function Wn({page:n,type:a,originalElement:t}){return a==="prev"?n===0?null:Be(Sn):a==="next"?n===1?null:Be(wn):t}function Gn(n){const{t:a}=xe(),t=N({}),s=N(!0);de(()=>e(n).pagination,o=>{!Ce(o)&&o&&(t.value=k(k({},e(t)),o!=null?o:{}))});const l=T(()=>{const{pagination:o}=e(n);return!e(s)||Ce(o)&&!o?!1:k(k({current:1,size:"small",defaultPageSize:Qe,showTotal:S=>a("component.table.total",{total:S}),showSizeChanger:!0,pageSizeOptions:Hn,itemRender:Wn,showQuickJumper:!0},Ce(o)?{}:o),e(t))});function c(o){const S=e(l);t.value=k(k({},Ce(S)?{}:S),o)}function f(){return e(l)}function u(){return e(s)}function r(o){return le(this,null,function*(){s.value=o})}return{getPagination:f,getPaginationInfo:l,setShowPagination:r,getShowPagination:u,setPagination:c}}function qn(n){return({text:a,record:t,index:s})=>(Se(t).onValid=()=>le(this,null,function*(){if(Ue(t==null?void 0:t.validCbs)){const l=((t==null?void 0:t.validCbs)||[]).map(f=>f());return(yield Promise.all(l)).every(f=>!!f)}else return!1}),Se(t).onEdit=(l,c=!1)=>le(this,null,function*(){var f,u;return c||(t.editable=l),!l&&c?(yield t.onValid())&&(yield(f=t.onSubmitEdit)==null?void 0:f.call(t))?(t.editable=!1,!0):!1:(!l&&!c&&((u=t.onCancelEdit)==null||u.call(t)),!0)}),Be($n,{value:a,record:t,column:n,index:s}))}function xt(n,a){const{key:t,dataIndex:s,children:l}=n;n.align=n.align||Nn,a&&(t||(n.key=typeof s=="object"?s.join("-"):s),Ce(n.ellipsis)||Object.assign(n,{ellipsis:a})),l&&l.length&&Rt(l,!!a)}function Rt(n,a){n&&n.forEach(t=>{const{children:s}=t;xt(t,a),Rt(s,a)})}function Yn(n,a,t){const{t:s}=xe(),{showIndexColumn:l,indexColumnProps:c,isTreeTable:f}=e(n);let u=!1;if(e(f)||(t.forEach(()=>{const o=t.findIndex(S=>S.flag===Pe);l?u=o===-1:!l&&o!==-1&&t.splice(o,1)}),!u))return;const r=t.some(o=>o.fixed==="left");t.unshift(k(k({flag:Pe,width:60,title:s("component.table.index"),align:"center",customRender:({index:o})=>{const S=e(a);if(Ce(S))return`${o+1}`;const{current:I=1,pageSize:L=Qe}=S;return((I<1?1:I)-1)*L+o+1}},r?{fixed:"left"}:{}),c))}function Jn(n,a){const{actionColumn:t}=e(n);if(!t)return;const s=a.findIndex(l=>l.flag===je);s===-1&&a.push(ie(k(ie(k({},a[s]),{fixed:"right"}),t),{flag:je}))}function Vn(n,a){const t=N(e(n).columns);let s=e(n).columns;const l=T(()=>{const y=ye(e(t));if(Yn(n,a,y),Jn(n,y),!y)return[];const{ellipsis:g}=e(n);return y.forEach(i=>{const{customRender:h,slots:p}=i;xt(i,Reflect.has(i,"ellipsis")?!!i.ellipsis:!!g&&!h&&!p)}),y});function c(y){const g=y.ifShow;let i=!0;return Ce(g)&&(i=g),X(g)&&(i=g(y)),i}const{hasPermission:f}=ln(),u=T(()=>{const y=ft(e(l)),g=h=>{const{slots:p,customRender:C,format:_,edit:$,editRow:O,flag:A}=h;(!p||!(p!=null&&p.title))&&(h.customTitle=h.title);const j=[Pe,je].includes(A);return!C&&_&&!$&&!j&&(h.customRender=({text:U,record:Q,index:he})=>Xn(U,_,Q,he)),($||O)&&!j&&(h.customRender=qn(h)),gt(h)};return ye(y).filter(h=>f(h.auth)&&c(h)).map(h=>{var p;return(p=h.children)!=null&&p.length&&(h.children=h.children.map(g)),g(h)})});de(()=>e(n).columns,y=>{var g;t.value=y,s=(g=y==null?void 0:y.filter(i=>!i.flag))!=null?g:[]});function r(y,g){!y||!g||s.forEach(i=>{if(i.dataIndex===y){Object.assign(i,g);return}})}function o(y){const g=ye(y);if(!Ue(g))return;if(g.length<=0){t.value=[];return}const i=g[0],h=s.map(p=>p.dataIndex);if(!Xe(i)&&!Ue(i))t.value=g;else{const p=g.map(_=>_.toString()),C=[];s.forEach(_=>{var $;C.push(ie(k({},_),{defaultHidden:!p.includes((($=_.dataIndex)==null?void 0:$.toString())||_.key)}))}),bn(h,g)||C.sort((_,$)=>{var O,A;return p.indexOf((O=_.dataIndex)==null?void 0:O.toString())-p.indexOf((A=$.dataIndex)==null?void 0:A.toString())}),t.value=C}}function S(y){const{ignoreIndex:g,ignoreAction:i,sort:h}=y||{};let p=Se(e(l));return g&&(p=p.filter(C=>C.flag!==Pe)),i&&(p=p.filter(C=>C.flag!==je)),h&&(p=ft(p)),p}function I(){return s}function L(y){Ue(y)&&(s=y.filter(g=>!g.flag))}function z(y,g){g.width=y}return{getColumnsRef:l,getCacheColumns:I,getColumns:S,setColumns:o,setColumnWidth:z,getViewColumns:u,setCacheColumnsByField:r,setCacheColumns:L}}function ft(n){const a=[],t=[],s=[];for(const u of n){if(u.fixed==="left"){a.push(u);continue}if(u.fixed==="right"){t.push(u);continue}s.push(u)}const l=u=>!u.defaultHidden,c=[...a,...s,...t].filter(l),f=[...c];for(;f.length;){const u=f[0];Array.isArray(u.children)?(u.children=u.children.filter(l),f.shift(),f.unshift(...u.children)):f.shift()}return c}function Xn(n,a,t,s){if(!a)return n;if(X(a))return a(n,t,s);try{const l="date|";if(Xe(a)&&a.startsWith(l)&&n){const c=a.replace(l,"");return c?sn(n,c):n}if(_n(a))return a.get(n)}catch(l){return n}}function Zn(n,{getPaginationInfo:a,setPagination:t,setLoading:s,getFieldsValue:l,clearSelectedRowKeys:c,tableData:f},u){const r=gt({sortInfo:{},filterInfo:{}}),o=N([]),S=N({}),I=N({});mt(()=>{f.value=e(o)}),de(()=>e(n).dataSource,()=>{const{dataSource:v,api:b}=e(n);!b&&v&&(o.value=v)},{immediate:!0});function L(v,b,D){const{clearSelectOnPageChange:B,sortFn:H,filterFn:Y}=e(n);B&&c(),t(v);const F={};if(D&&X(H)){const J=H(D);r.sortInfo=J,F.sortInfo=J}if(b&&X(Y)){const J=Y(b);r.filterInfo=J,F.filterInfo=J}O(F)}function z(v){!v||!Array.isArray(v)||v.forEach(b=>{b[ve]||(b[ve]=rt()),b.children&&b.children.length&&z(b.children)})}const y=T(()=>e(n).autoCreateKey&&!e(n).rowKey),g=T(()=>{const{rowKey:v}=e(n);return e(y)?ve:v}),i=N([]);de(()=>o.value,()=>{const v=e(o);if((!v||v.length===0)&&(i.value=e(o)),e(y)){const b=v[0],D=v[v.length-1];if(b&&D&&(!b[ve]||!D[ve])){const B=ye(e(o));B.forEach(H=>{H[ve]||(H[ve]=rt()),H.children&&H.children.length&&z(H.children)}),o.value=B}}i.value=e(o)},{deep:!0,immediate:!0});function h(v,b,D){return le(this,null,function*(){return o.value[v]&&(o.value[v][b]=D),o.value[v]})}function p(v,b){const D=$(v);if(D){for(const B in D)Reflect.has(b,B)&&(D[B]=b[B]);return D}}function C(v){var B;if(!o.value||o.value.length==0)return;const b=Array.isArray(v)?v:[v];function D(H,Y){const F=J(H,Y);if(F===null||F.index===-1)return;F.data.splice(F.index,1);function J(ee,ge){var me;if(ee==null)return null;for(let te=0;te<ee.length;te++){const ne=ee[te];if(se(e(g),ne)===ge)return{index:te,data:ee};if(((me=ne.children)==null?void 0:me.length)>0){const pe=J(ne.children,ge);if(pe!=null)return pe}}return null}}for(const H of b)D(o.value,H),D(e(n).dataSource,H);t({total:(B=e(n).dataSource)==null?void 0:B.length})}function _(v,b){var B;b=b!=null?b:(B=o.value)==null?void 0:B.length;const D=rn(v)?[v]:v;return e(o).splice(b,0,...D),e(o)}function $(v){if(!o.value||o.value.length===0)return;const{childrenColumnName:b="children"}=e(n);return(B=>{let H;return B.some(function Y(F){return se(e(g),F)===v?(H=F,!0):F[b]&&F[b].some(Y)}),H})(o.value)}function O(v){return le(this,null,function*(){var ge,me,te;const{api:b,searchInfo:D,defSort:B,fetchSetting:H,beforeFetch:Y,afterFetch:F,useSearchForm:J,pagination:ee}=e(n);if(!(!b||!X(b)))try{s(!0);const{pageField:ne,sizeField:pe,listField:Re,totalField:Te}=Object.assign({},zn,H);let _e={};const{current:Ie=1,pageSize:ke=Qe}=e(a);Ce(ee)&&!ee||Ce(a)?_e={}:(_e[ne]=v&&v.page||Ie,_e[pe]=ke);const{sortInfo:d={},filterInfo:w}=r;let R=xn(_e,J?l():{},D,(ge=v==null?void 0:v.searchInfo)!=null?ge:{},B,d,w,(me=v==null?void 0:v.sortInfo)!=null?me:{},(te=v==null?void 0:v.filterInfo)!=null?te:{});Y&&X(Y)&&(R=(yield Y(R))||R),I.value=R;const m=yield b(R);S.value=m;const E=Array.isArray(m);let ae=E?m:ct(m,Re);const oe=E?m.length:ct(m,Te);if(Number(oe)){const He=Math.ceil(oe/ke);if(Ie>He)return t({current:He}),yield O(v)}return F&&X(F)&&(ae=(yield F(ae))||ae),o.value=ae,t({total:oe||0}),v&&v.page&&t({current:v.page||1}),u("fetch-success",{items:e(ae),total:oe}),ae}catch(ne){u("fetch-error",ne),o.value=[],t({total:0})}finally{s(!1)}})}function A(v){o.value=v}function j(){return i.value}function U(){return S.value}function Q(v){return le(this,null,function*(){return yield O(v)})}function he(){return I.value}return Ve(()=>{cn(()=>{e(n).immediate&&O()},16)}),{getDataSourceRef:T(()=>i.value),getDataSource:j,getRawDataSource:U,searchInfoRef:I,getSearchInfo:he,getRowKey:g,setTableData:A,getAutoCreateKey:y,fetch:O,reload:Q,updateTableData:h,updateTableDataRecord:p,deleteTableDataRecord:C,insertTableDataRecord:_,findTableDataRecord:$,handleTableChange:L}}function Qn(n){const a=N(e(n).loading);de(()=>e(n).loading,l=>{a.value=l});const t=T(()=>e(a));function s(l){a.value=l}return{getLoading:t,setLoading:s}}function ea(n,a,t){const s=N([]),l=N([]),c=T(()=>{const{rowSelection:i}=e(n);return i?k({selectedRowKeys:e(s),onChange:(h,p,C)=>{var _,$;if(C)(_=i.onChange)==null||_.call(i,h,p);else{const O=r();for(const A of s.value.filter(j=>O.includes(j)))if(h.findIndex(j=>j===A)<0){const j=s.value.findIndex(U=>U===A);j>-1&&(s.value.splice(j,1),l.value.splice(j,1))}for(const A of h)if(s.value.findIndex(U=>U===A)<0){s.value.push(A);const U=p.find(Q=>se(e(u),Q)===A);U&&l.value.push(U)}o(s.value),($=i.onChange)==null||$.call(i,s.value,l.value)}}},Ze(i,["onChange"])):null});de(()=>{var i;return(i=e(n).rowSelection)==null?void 0:i.selectedRowKeys},i=>{o(i)}),de(()=>e(s),()=>{Fe(()=>{const{rowSelection:i}=e(n);if(i){const{onChange:h}=i;h&&X(h)&&h(z(),y(),!0)}t("selection-change",{keys:z(),rows:y()})})},{deep:!0});const f=T(()=>e(n).autoCreateKey&&!e(n).rowKey),u=T(()=>{const{rowKey:i}=e(n);return e(f)?ve:i});function r(){const{childrenColumnName:i="children"}=e(n),h=[],p=C=>{var _;h.push(se(e(u),C)),(_=C[i])!=null&&_.length&&C[i].forEach(p)};return a.value.forEach(p),h}function o(i){var _;s.value=i||[];const h=Se(e(a)).concat(Se(e(l))),p=un(h,$=>i==null?void 0:i.includes(se(e(u),$)),{children:(_=n.value.childrenColumnName)!=null?_:"children"}),C=[];i==null||i.forEach($=>{const O=p.find(A=>se(e(u),A)===$);O?C.push(O):h[0]&&C.push({[Je(e(u),h[0])]:$})}),l.value=C}function S(i){l.value=i,s.value=l.value.map(h=>se(e(u),h))}function I(){l.value=[],s.value=[]}function L(i){const p=e(s).findIndex(C=>C===i);p!==-1&&e(s).splice(p,1)}function z(){return e(s)}function y(){return e(l)}function g(){return e(c)}return{getRowSelection:g,getRowSelectionRef:c,getSelectRows:y,getSelectRowKeys:z,setSelectedRowKeys:o,clearSelectedRowKeys:I,deleteSelectRowByKey:L,setSelectedRows:S}}function ta(n,a){let t;function s(c){return le(this,null,function*(){var r;const{id:f}=c,u=t==null?void 0:t.querySelector(`[data-row-key="${f}"]`);yield Fe(),t==null||t.scrollTo({top:(r=u==null?void 0:u.offsetTop)!=null?r:0,behavior:"smooth"})})}function l(c){const f=e(n);if(!f)return;const u=f.$el;if(!u||!t&&(t=u.querySelector(".ant-table-body"),!t))return;const r=e(a);if(r)if(c==="top")s(r[0]);else if(c==="bottom")s(r[r.length-1]);else{const o=r.find(S=>S.id===c);o&&s(o)}}return{scrollTo:l}}function na(n,{setSelectedRowKeys:a,getSelectRowKeys:t,getAutoCreateKey:s,clearSelectedRowKeys:l,emit:c}){return{customRow:(u,r)=>({onClick:o=>{o==null||o.stopPropagation();function S(){var p;const{rowSelection:I,rowKey:L,clickToRowSelect:z}=e(n);if(!I||!z)return;const y=t()||[],g=se(L,u,e(s));if(!g)return;if(I.type==="checkbox"){const C=(p=o.composedPath)==null?void 0:p.call(o).find(O=>O.tagName==="TR");if(!C)return;const _=C.querySelector("input[type=checkbox]");if(!_||_.hasAttribute("disabled"))return;if(!y.includes(g)){y.push(g),a(y);return}const $=y.findIndex(O=>O===g);y.splice($,1),a(y);return}if(I.type==="radio"){if(!y.includes(g)){y.length&&l(),a([g]);return}l()}}S(),c("row-click",u,r,o)},onDblclick:o=>{c("row-dbClick",u,r,o)},onContextmenu:o=>{c("row-contextmenu",u,r,o)},onMouseenter:o=>{c("row-mouseenter",u,r,o)},onMouseleave:o=>{c("row-mouseleave",u,r,o)}})}}function aa(n,a){function t(s,l){const{striped:c,rowClassName:f}=e(n),u=[];return c&&u.push((l||0)%2===1?`${a}-row__striped`:""),f&&X(f)&&u.push(f(s,l)),u.filter(r=>!!r).join(" ")}return{getRowClassName:t}}const oa=["data-no"],la=ce({name:"ColumnSetting",__name:"ColumnSetting",props:{cache:{type:Boolean,default:()=>!1}},emits:["columns-change"],setup(n,{emit:a}){const t=_t(),s=a,l=en(),{t:c}=xe(),{prefixCls:f}=Ae("basic-column-setting"),u=pt(),r=De(),o=n,S=()=>X(u.getPopupContainer)?u.getPopupContainer():St();let I=!1,L=!1,z,y=[],g=!1,i=!1;const h=N([]),p=N(null),C=N([]);de(C,()=>{g&&(h.value.filter(d=>C.value.includes(d.value)).forEach(d=>{d.column.defaultHidden=!1}),h.value.filter(d=>!C.value.includes(d.value)).forEach(d=>{d.column.defaultHidden=!0,d.fixed=void 0}),te(),F(),o.cache&&he())});const _=N(!1),$=()=>{C.value.length<h.value.length?C.value=h.value.map(d=>d.value):C.value=[]},O=T(()=>C.value.length>0&&C.value.length<h.value.length),A=N(!1),j=d=>{ne(d.target.checked),o.cache&&typeof l.name=="string"&&t.setShowIndexColumn(l.name,d.target.checked)},U=N(!1),Q=d=>{pe(d.target.checked),o.cache&&typeof l.name=="string"&&t.setShowRowSelection(l.name,d.target.checked)},he=()=>{typeof l.name=="string"&&t.setColumns(l.name,h.value)},v=()=>{A.value=I,j({target:{checked:I}}),U.value=L,Q({target:{checked:L}}),h.value=ye(y),Re()},b=(d,w)=>{w==="left"?!d.fixed||d.fixed==="right"?d.fixed="left":d.fixed=void 0:w==="right"&&(!d.fixed||d.fixed==="left"?d.fixed="right":d.fixed=void 0),F(),o.cache&&he()},D=()=>le(this,null,function*(){if(p.value){const d=p.value.$el;Array.from(d.children).forEach(w=>d.removeChild(w))}yield Fe()}),B=d=>{if(d){if("ifShow"in d){if(typeof d.ifShow=="boolean")return d.ifShow;if(d.ifShow)return d.ifShow(d)}return!0}return!1},H=()=>r.getColumns({ignoreIndex:!0,ignoreAction:!0}).filter(d=>B(d)),Y=d=>{i=!0,r==null||r.setColumns(d);const w=d.map(R=>({dataIndex:R.dataIndex?R.dataIndex.toString():"",fixed:R.fixed,visible:!R.defaultHidden}));s("columns-change",w)},F=()=>{var m;const d=ye(r.getColumns());let w=d.filter(E=>E.flag!==Pe&&(E.fixed==="left"||E.fixed===!0)).length;A.value&&w++;for(const E of h.value){const ae=d.findIndex(oe=>oe.dataIndex===E.value);if(ae>-1){const oe=d[ae];oe.defaultHidden=(m=E.column)==null?void 0:m.defaultHidden,oe.fixed=E.fixed,d.splice(ae,1),d.splice(w++,0,oe)}}const R=d.findIndex(E=>E.dataIndex==="action");if(R>-1){const E=d.splice(R,1);d.push(E[0])}Y(d)},J=()=>le(this,null,function*(){if(yield Fe(),p.value){const d=p.value.$el;Mn.create(e(d),{animation:500,delay:400,delayOnTouchOnly:!0,handle:".table-column-drag-icon ",dataIdAttr:"data-no",onEnd:w=>{const{oldIndex:R,newIndex:m}=w;if(it(R)||it(m)||R===m)return;const E=ye(h.value);R>m?(E.splice(m,0,E[R]),E.splice(R+1,1)):(E.splice(m+1,0,E[R]),E.splice(R,1)),h.value=E,F(),o.cache&&he()}})}}),ee=()=>{if(typeof l.name=="string"){let d=t.getColumns(l.name);if(d&&JSON.stringify(h.value.map(w=>({value:w.value,label:w.label})))!==JSON.stringify(d.map(w=>({value:w.value,label:w.label})))){const w=h.value.reduce((R,m)=>(R[m.value]=m.label,R),{});if(Array.isArray(d)){d=d.filter(m=>w[m.value]),d.forEach(m=>{m.label=w[m.value]});const R=d.map(m=>m.value);d=d.concat(h.value.filter(m=>!R.includes(m.value))),t.setColumns(l.name,d)}}}},ge=()=>{if(typeof l.name=="string"){const d=t.getShowIndexColumn(l.name);typeof d=="boolean"&&(A.value=I&&d);const w=t.getShowRowSelection(l.name);typeof w=="boolean"&&(U.value=L&&w)}if(j({target:{checked:A.value}}),Q({target:{checked:U.value}}),typeof l.name=="string"){const d=t.getColumns(l.name);Array.isArray(d)&&(h.value=d)}},me=()=>{C.value=h.value.filter(d=>{var w;return!((w=d.column)!=null&&w.defaultHidden)}).map(d=>d.value)},te=()=>{_.value=h.value.length===C.value.length},ne=d=>{i=!0,r.setProps({showIndexColumn:d})},pe=d=>{i=!0,r.setProps({rowSelection:d?ie(k({},Ze(z,["selectedRowKeys"])),{fixed:!0}):void 0})},Re=()=>{me(),te(),ne(A.value),pe(U.value),F()},Te=()=>le(this,null,function*(){var d;if(!g){const w=H();(d=r.setCacheColumns)==null||d.call(r,w);const R=[];for(const m of w)R.push({label:typeof m.title=="string"?m.title:typeof m.customTitle=="string"?m.customTitle:"",value:typeof m.dataIndex=="string"?m.dataIndex:typeof m.title=="string"?m.title:"",column:{defaultHidden:m.defaultHidden},fixed:m.fixed});I=r.getBindValues.value.showIndexColumn||!1,z=r.getRowSelection(),L=!!z,y=R,A.value=I,U.value=L,h.value=ye(R),o.cache&&ee(),o.cache&&ge(),Re(),g=!0}});le(this,null,function*(){yield D(),Te()});const Ie=T(()=>r==null?void 0:r.getColumns()),ke=T(()=>r==null?void 0:r.getBindValues);return Ve(()=>{de([Ie,ke],()=>{i?i=!1:(g=!1,Te())})}),(d,w)=>{const R=vt("a-button");return P(),G(e(Ke),{placement:"top"},{title:x(()=>[ue("span",null,W(e(c)("component.table.settingColumn")),1)]),default:x(()=>[K(e(Rn),{placement:"bottomLeft",trigger:"click",onOpenChange:J,overlayClassName:`${e(f)}__column-list`,getPopupContainer:S},{title:x(()=>[ue("div",{class:be(`${e(f)}__popover-title`)},[K(e(Oe),{indeterminate:O.value,checked:_.value,"onUpdate:checked":w[0]||(w[0]=m=>_.value=m),onChange:$},{default:x(()=>[re(W(e(c)("component.table.settingColumnShow")),1)]),_:1},8,["indeterminate","checked"]),K(e(Oe),{checked:A.value,"onUpdate:checked":w[1]||(w[1]=m=>A.value=m),onChange:j},{default:x(()=>[re(W(e(c)("component.table.settingIndexColumnShow")),1)]),_:1},8,["checked"]),e(L)?(P(),G(e(Oe),{key:0,checked:U.value,"onUpdate:checked":w[2]||(w[2]=m=>U.value=m),onChange:Q},{default:x(()=>[re(W(e(c)("component.table.settingSelectColumnShow")),1)]),_:1},8,["checked"])):V("",!0),K(R,{size:"small",type:"link",onClick:v},{default:x(()=>[re(W(e(c)("common.resetText")),1)]),_:1})],2)]),content:x(()=>[K(e(fn),null,{default:x(()=>[K(e(Oe).Group,{value:C.value,"onUpdate:value":w[3]||(w[3]=m=>C.value=m),ref_key:"columnOptionsRef",ref:p},{default:x(()=>[(P(!0),fe(tn,null,Ye(h.value,m=>(P(),fe("div",{key:m.value,class:be(`${e(f)}__check-item`),"data-no":m.value},[K(e(Tn),{class:"table-column-drag-icon"}),K(e(Oe),{value:m.value},{default:x(()=>[re(W(m.label),1)]),_:2},1032,["value"]),K(e(Ke),{placement:"bottomLeft",mouseLeaveDelay:.4,getPopupContainer:S},{title:x(()=>[re(W(e(c)("component.table.settingFixedLeft")),1)]),default:x(()=>[K(st,{icon:"line-md:arrow-align-left",class:be([`${e(f)}__fixed-left`,{active:m.fixed==="left",disabled:m.value?!C.value.includes(m.value):!0}]),onClick:E=>b(m,"left")},null,8,["class","onClick"])]),_:2},1024),K(e(wt),{type:"vertical"}),K(e(Ke),{placement:"bottomLeft",mouseLeaveDelay:.4,getPopupContainer:S},{title:x(()=>[re(W(e(c)("component.table.settingFixedRight")),1)]),default:x(()=>[K(st,{icon:"line-md:arrow-align-left",class:be([`${e(f)}__fixed-right`,{active:m.fixed==="right",disabled:m.value?!C.value.includes(m.value):!0}]),onClick:E=>b(m,"right")},null,8,["class","onClick"])]),_:2},1024)],10,oa))),128))]),_:1},8,["value"])]),_:1})]),default:x(()=>[K(e(In))]),_:1},8,["overlayClassName"])]),_:1})}}}),sa=ce({name:"SizeSetting",__name:"SizeSetting",setup(n){const a=_t(),t=De(),{t:s}=xe(),l=N([t.getSize()]),c=({key:f})=>{l.value=[f],a.setTableSize(f),t.setProps({size:f})};return Ve(()=>{l.value=[a.getTableSize],t.setProps({size:l.value[0]})}),(f,u)=>(P(),G(e(Ke),{placement:"top"},{title:x(()=>[ue("span",null,W(e(s)("component.table.settingDens")),1)]),default:x(()=>[K(e(kn),{placement:"bottom",trigger:["click"],getPopupContainer:e(St)},{overlay:x(()=>[K(e(Me),{onClick:c,selectable:"",selectedKeys:l.value,"onUpdate:selectedKeys":u[0]||(u[0]=r=>l.value=r)},{default:x(()=>[K(e(Me).Item,{key:"default"},{default:x(()=>[ue("span",null,W(e(s)("component.table.settingDensDefault")),1)]),_:1}),K(e(Me).Item,{key:"middle"},{default:x(()=>[ue("span",null,W(e(s)("component.table.settingDensMiddle")),1)]),_:1}),K(e(Me).Item,{key:"small"},{default:x(()=>[ue("span",null,W(e(s)("component.table.settingDensSmall")),1)]),_:1})]),_:1},8,["selectedKeys"])]),default:x(()=>[K(e(Kn))]),_:1},8,["getPopupContainer"])]),_:1}))}}),ca=ce({name:"RedoSetting",__name:"RedoSetting",setup(n){const a=De(),{t}=xe();function s(){a.reload()}return(l,c)=>(P(),G(e(Ke),{placement:"top"},{title:x(()=>[ue("span",null,W(e(t)("common.redo")),1)]),default:x(()=>[K(e(Fn),{onClick:s})]),_:1}))}}),ia=ce({name:"FullScreenSetting",__name:"FullScreenSetting",setup(n){const a=De(),{t}=xe(),{toggle:s,isFullscreen:l}=dn(a.wrapRef);return(c,f)=>(P(),G(e(Ke),{placement:"top"},{title:x(()=>[ue("span",null,W(e(t)("component.table.settingFullScreen")),1)]),default:x(()=>[e(l)?(P(),G(e(An),{key:1,onClick:e(s)},null,8,["onClick"])):(P(),G(e(Pn),{key:0,onClick:e(s)},null,8,["onClick"]))]),_:1}))}}),ra={class:"table-settings"},ua=ce({name:"TableSetting",__name:"index",props:{setting:{type:Object,default:()=>({})}},emits:["columns-change"],setup(n,{emit:a}){const t=n,s=a,l=De(),c=T(()=>k({redo:!0,size:!0,setting:!0,settingCache:!0,fullScreen:!1},t.setting));function f(r){s("columns-change",r)}function u(){return l?e(l.wrapRef):document.body}return(r,o)=>(P(),fe("div",ra,[c.value.redo?(P(),G(ca,{key:0,getPopupContainer:u})):V("",!0),c.value.size?(P(),G(sa,{key:1,getPopupContainer:u})):V("",!0),c.value.setting?(P(),G(la,{key:2,onColumnsChange:f,getPopupContainer:u,cache:c.value.settingCache},null,8,["cache"])):V("",!0),c.value.fullScreen?(P(),G(ia,{key:3,getPopupContainer:u})):V("",!0)]))}}),fa=ce({name:"BasicTableTitle",__name:"TableTitle",props:{title:{type:[Function,String]},getSelectRows:{type:Function},helpMessage:{type:[String,Array]}},setup(n){const a=n,{prefixCls:t}=Ae("basic-table-title"),s=T(()=>{const{title:l,getSelectRows:c=()=>{}}=a;let f=l;return X(l)&&(f=l({selectRows:c()})),f});return(l,c)=>s.value?(P(),G(e(hn),{key:0,class:be(e(t)),helpMessage:n.helpMessage},{default:x(()=>[re(W(s.value),1)]),_:1},8,["class","helpMessage"])):V("",!0)}}),da={key:0},ha={key:1},ga=ce({name:"TableSelectBar",__name:"TableSelectionBar",props:{count:{default:()=>0},clearSelectedRowKeys:{}},setup(n){const{t:a}=xe(),{prefixCls:t}=Ae("table-select-bar"),s=n;return(l,c)=>{const f=vt("a-button");return P(),G(e(Dn),{type:"info",showIcon:"",class:be([e(t)])},{message:x(()=>[s.count>0?(P(),fe("span",da,W(e(a)("component.table.selectionBarTips",{count:s.count})),1)):(P(),fe("span",ha,W(e(a)("component.table.selectionBarEmpty")),1)),Ct(K(f,{type:"link",onClick:l.clearSelectedRowKeys,size:"small"},{default:x(()=>[re(W(e(a)("component.table.selectionBarClear")),1)]),_:1},8,["onClick"]),[[yt,s.count>0]])]),_:1},8,["class"])}}}),ma=gn(ga,[["__scopeId","data-v-80ee960a"]]),pa={style:{width:"100%"}},va={key:0,style:{margin:"5px"}},Ca={key:1,style:{margin:"5px"}},ya={class:"flex items-center"},Sa=ce({name:"BasicTableHeader",__name:"TableHeader",props:{title:{type:[Function,String]},tableSetting:{type:Object},showTableSetting:{type:Boolean},titleHelpMessage:{type:[String,Array],default:""},clearSelectedRowKeys:{type:Function},count:{type:Number,default:0},showSelectionBar:{type:Boolean,default:!1}},emits:["columns-change"],setup(n,{emit:a}){const t=n,s=a,{prefixCls:l}=Ae("basic-table-header");function c(f){s("columns-change",f)}return(f,u)=>(P(),fe("div",pa,[f.$slots.headerTop?(P(),fe("div",va,[we(f.$slots,"headerTop")])):V("",!0),n.showSelectionBar?(P(),fe("div",Ca,[K(ma,{clearSelectedRowKeys:t.clearSelectedRowKeys,count:t.count},null,8,["clearSelectedRowKeys","count"])])):V("",!0),ue("div",ya,[f.$slots.tableTitle?we(f.$slots,"tableTitle",{key:0}):V("",!0),!f.$slots.tableTitle&&n.title?(P(),G(fa,{key:1,helpMessage:n.titleHelpMessage,title:n.title},null,8,["helpMessage","title"])):V("",!0),ue("div",{class:be(`${e(l)}__toolbar`)},[we(f.$slots,"toolbar"),f.$slots.toolbar&&n.showTableSetting?(P(),G(e(wt),{key:0,type:"vertical"})):V("",!0),n.showTableSetting?(P(),G(ua,{key:1,setting:n.tableSetting,onColumnsChange:c},null,8,["setting"])):V("",!0)],2)])]))}});function wa(n,a,t,s){return{getHeaderProps:T(()=>{const{title:c,showTableSetting:f,titleHelpMessage:u,tableSetting:r,showSelectionBar:o}=e(n),S=!a.tableTitle&&!c&&!a.toolbar&&!f;return S&&!Xe(c)?{}:{title:S?null:()=>Be(Sa,{title:c,titleHelpMessage:u,showTableSetting:f,tableSetting:r,onColumnsChange:t.onColumnsChange,clearSelectedRowKeys:s.clearSelectedRowKeys,count:s.getSelectRowKeys().length,showSelectionBar:o},k(k(k({},a.toolbar?{toolbar:()=>qe(a,"toolbar")}:{}),a.tableTitle?{tableTitle:()=>qe(a,"tableTitle")}:{}),a.headerTop?{headerTop:()=>qe(a,"headerTop")}:{}))}})}}function ba(n,a,t){const s=N([]),l=T(()=>e(n).autoCreateKey&&!e(n).rowKey),c=T(()=>{const{rowKey:g}=e(n);return e(l)?ve:g}),f=T(()=>{const{isTreeTable:g,expandRowByClick:i}=e(n);return!g&&!i?{}:{expandedRowKeys:e(s),onExpandedRowsChange:h=>{s.value=h,t("expanded-rows-change",h)}}});function u(){const g=I();s.value=g}function r(){s.value=[]}function o(g){const{isTreeTable:i,expandRowByClick:h}=e(n);!i&&!h||(s.value=[...s.value,...g])}function S(g){const{isTreeTable:i,expandRowByClick:h}=e(n);!i&&!h||(s.value=e(s).filter(p=>!g.includes(p)))}function I(g){const i=[],{childrenColumnName:h}=e(n);return Se(g||e(a)).forEach(p=>{i.push(se(e(c),p));const C=p[h||"children"];C!=null&&C.length&&i.push(...I(C))}),i}function L(g,i,h,p){if(g.findIndex(C=>se(e(c),C)===h)>-1)return p.push(h),!0;for(const C of g){const _=C[i];if(Array.isArray(_)&&L(_,i,h,p))return p.push(se(e(c),C)),!0}return!1}function z(g){const{childrenColumnName:i}=e(n),h=[];L(a.value,i||"children",g,h),s.value=h}function y(g,i){n.value.accordion&&(n.value.isTreeTable||n.value.expandRowByClick)&&g&&Fe(()=>{z(se(e(c),i))})}return{getExpandOption:f,expandAll:u,collapseAll:r,expandRows:o,collapseRows:S,expandRowAccordion:z,handleTableExpand:y}}const dt="_row",ht="_index",_a=ce({name:"BasicTableFooter",__name:"TableFooter",props:{summaryFunc:{default:null},summaryData:{default:null},scroll:{},rowKey:{default:""}},setup(n){const a=n,t=De(),s=T(()=>{var f;if((f=a.summaryData)!=null&&f.length)return a.summaryData.forEach((u,r)=>{u[Je(a.rowKey,u)]=`${r}`}),a.summaryData;if(!X(a.summaryFunc))return[];let c=Se(e(t.getDataSource()));return c=a.summaryFunc(c),c.forEach((u,r)=>{u[Je(a.rowKey,u)]=`${r}`}),c}),l=T(()=>{const c=e(s),f=ye(t.getColumns()),u=f.findIndex(S=>S.flag===Pe),r=c.some(S=>Reflect.has(S,dt)),o=c.some(S=>Reflect.has(S,ht));if(u!==-1&&(o?(f[u].customRender=({record:S})=>S[ht],f[u].ellipsis=!1):Reflect.deleteProperty(f[u],"customRender")),t.getRowSelection()&&r){const S=f.some(I=>I.fixed==="left");f.unshift(ie(k({width:60,title:"selection",key:"selectionKey",align:"center"},S?{fixed:"left"}:{}),{customRender:({record:I})=>I[dt]}))}return f});return(c,f)=>a.summaryFunc||a.summaryData?(P(),G(e(bt),{key:0,showHeader:!1,bordered:!1,pagination:!1,dataSource:s.value,rowKey:a.rowKey,columns:l.value,tableLayout:"fixed",scroll:a.scroll},null,8,["dataSource","rowKey","columns","scroll"])):V("",!0)}});function xa(n,a,t,s){const l=T(()=>(e(s)||[]).length===0),c=T(()=>{const{summaryFunc:u,showSummary:r,summaryData:o}=e(n);return r&&!e(l)?()=>Be(_a,{summaryFunc:u,summaryData:o,scroll:e(a)}):void 0});mt(()=>{f()});function f(){const{showSummary:u}=e(n);!u||e(l)||Fe(()=>{const r=e(t);if(!r)return;const o=r.$el.querySelector(" .ant-table-content,  .ant-table-body");mn({el:o,name:"scroll",listener:()=>{const S=r.$el.querySelector('.ant-table-footer .ant-table-container  [class^="ant-table-"]');!S||!o||(S.scrollLeft=o.scrollLeft)},wait:0,options:!0})})}return{getFooterProps:c}}function Ra(n,a,t,s){const l=T(()=>{const{formConfig:r}=e(n),{submitButtonOptions:o}=r||{};return ie(k({showAdvancedButton:!0},r),{submitButtonOptions:k({loading:e(s)},o),compact:!0})}),c=T(()=>Object.keys(a).map(o=>o.startsWith("form-")?o:null).filter(o=>!!o));function f(r){var o,S;return r&&(S=(o=r==null?void 0:r.replace)==null?void 0:o.call(r,/form-/,""))!=null?S:""}function u(r){const{handleSearchInfoFn:o}=e(n);o&&X(o)&&(r=o(r)||r),t({searchInfo:r,page:1})}return{getFormProps:l,replaceFormSlotKey:f,getFormSlotKeys:c,handleSearchInfoChange:u}}const Ha=ce({name:"BasicTable",__name:"BasicTable",props:On,emits:["fetch-success","fetch-error","selection-change","register","row-click","row-dbClick","row-contextmenu","row-mouseenter","row-mouseleave","edit-end","edit-cancel","edit-row-end","edit-change","expanded-rows-change","change","columns-change"],setup(n,{expose:a,emit:t}){const s=n,l=t,c=pt(),f=nn(),u=N(null),r=N([]),o=N(null),S=N(null),I=N(),{height:L}=pn(o),{prefixCls:z}=Ae("basic-table"),[y,g]=Cn(),i=T(()=>k(k({},s),e(I))),h=an(vn,!1),{getLoading:p,setLoading:C}=Qn(i),{getPaginationInfo:_,getPagination:$,setPagination:O,setShowPagination:A,getShowPagination:j}=Gn(i),{getRowSelection:U,getRowSelectionRef:Q,getSelectRows:he,setSelectedRows:v,clearSelectedRowKeys:b,getSelectRowKeys:D,deleteSelectRowByKey:B,setSelectedRowKeys:H}=ea(i,r,l),{handleTableChange:Y,getDataSourceRef:F,getDataSource:J,getRawDataSource:ee,getSearchInfo:ge,setTableData:me,updateTableDataRecord:te,deleteTableDataRecord:ne,insertTableDataRecord:pe,findTableDataRecord:Re,fetch:Te,getRowKey:_e,reload:Ie,getAutoCreateKey:ke,updateTableData:d}=Zn(i,{tableData:r,getPaginationInfo:_,setLoading:C,setPagination:O,getFieldsValue:g.getFieldsValue,clearSelectedRowKeys:b},l);function w(M,Z,q,$e){Y(M,Z,q),l("change",M,Z,q);const{onChange:Ge}=e(i);Ge&&X(Ge)&&Ge(M,Z,q,$e)}const{getViewColumns:R,getColumns:m,setCacheColumnsByField:E,setCacheColumns:ae,setColumnWidth:oe,setColumns:He,getColumnsRef:Tt,getCacheColumns:It}=Vn(i,_),{getScrollRef:et,redoHeight:We}=Bn(i,u,Tt,Q,F,o,S),kt=En(We,50),{scrollTo:Kt}=ta(u,F),{customRow:Ft}=na(i,{setSelectedRowKeys:H,getSelectRowKeys:D,clearSelectedRowKeys:b,getAutoCreateKey:ke,emit:l}),{getRowClassName:Pt}=aa(i,z),{getExpandOption:At,expandAll:Dt,expandRows:Et,collapseRows:$t,collapseAll:Ot,handleTableExpand:Bt}=ba(i,r,l),Ht={onColumnsChange:M=>{var Z,q;l("columns-change",M),(q=(Z=e(i)).onColumnsChange)==null||q.call(Z,M)}},Nt={clearSelectedRowKeys:b,getSelectRowKeys:D},{getHeaderProps:zt}=wa(i,f,Ht,Nt),{getFooterProps:Lt}=xa(i,et,u,F),{getFormProps:Mt,replaceFormSlotKey:Ut,getFormSlotKeys:jt,handleSearchInfoChange:Wt}=Ra(i,f,Te,p),Ee=T(()=>{const M=e(F);let Z=k(ie(k(k(ie(k({},c),{customRow:Ft}),e(i)),e(zt)),{scroll:e(et),loading:e(p),tableLayout:"fixed",rowSelection:e(Q),rowKey:e(_e),columns:Se(e(R)),pagination:Se(e(_)),dataSource:M,footer:e(Lt)}),e(At));return Z=Ze(Z,["class","onChange"]),Z}),Gt=T(()=>{const M=e(Ee);return[z,c.class,{[`${z}-form-container`]:M.useSearchForm,[`${z}--inset`]:M.inset}]}),qt=T(()=>{const{emptyDataIsShowTable:M,useSearchForm:Z}=e(i);return M||!Z?!0:!!e(F).length});de(L,()=>{e(h)&&s.canResize&&kt()});function Yt(M){I.value=k(k({},e(I)),M)}const Ne={reload:Ie,getSelectRows:he,setSelectedRows:v,clearSelectedRowKeys:b,getSelectRowKeys:D,deleteSelectRowByKey:B,setPagination:O,setTableData:me,updateTableDataRecord:te,deleteTableDataRecord:ne,insertTableDataRecord:pe,findTableDataRecord:Re,redoHeight:We,setSelectedRowKeys:H,setColumns:He,setLoading:C,getDataSource:J,getRawDataSource:ee,getSearchInfo:ge,setProps:Yt,getRowSelection:U,getPaginationRef:$,getColumns:m,getCacheColumns:It,emit:l,updateTableData:d,setShowPagination:A,getShowPagination:j,setCacheColumnsByField:E,expandAll:Dt,collapseAll:Ot,expandRows:Et,collapseRows:$t,scrollTo:Kt,getSize:()=>e(Ee).size,setCacheColumns:ae};return Ln(ie(k({},Ne),{wrapRef:o,getBindValues:Ee})),l("register",Ne,g),a(k({tableElRef:u},Ne)),(M,Z)=>(P(),fe("div",{ref_key:"wrapRef",ref:o,class:be(Gt.value)},[Ee.value.useSearchForm?(P(),G(e(on),ot({key:0,ref_key:"formRef",ref:S,submitOnReset:""},e(Mt),{tableAction:Ne,onRegister:e(y),onSubmit:e(Wt),onAdvancedChange:e(We)}),at({_:2},[Ye(e(jt),q=>({name:e(Ut)(q),fn:x($e=>[we(M.$slots,q,ze(Le($e||{})))])}))]),1040,["onRegister","onSubmit","onAdvancedChange"])):V("",!0),Ct(K(e(bt),ot({ref_key:"tableElRef",ref:u},Ee.value,{rowClassName:e(Pt),onChange:w,onResizeColumn:e(oe),onExpand:e(Bt)}),at({headerCell:x(({column:q})=>[we(M.$slots,"headerCell",ze(Le({column:q})),()=>[K(jn,{column:q},null,8,["column"])])]),bodyCell:x(q=>[we(M.$slots,"bodyCell",ze(Le(q||{})))]),_:2},[Ye(Object.keys(M.$slots),q=>({name:q,fn:x($e=>[we(M.$slots,q,ze(Le($e||{})))])}))]),1040,["rowClassName","onResizeColumn","onExpand"]),[[yt,qt.value]])],2))}});export{Ha as _,jn as a};
